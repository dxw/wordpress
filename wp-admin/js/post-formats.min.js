window.wp=window.wp||{};(function(e){var a,b,g,d,i=["standard","chat","status","aside","gallery"],j=e(".post-formats-fields"),f=e(".icon32");function c(k){a.get(0).className=a.get(0).className.replace(/\s?\bwp-format-[^ ]+/g,"");a.addClass("wp-format-"+k);f.get(0).className=f.get(0).className.replace(/\s?\bwp-format-[^ ]+/g,"");f.addClass("wp-format-"+k)}function h(q){var m,k,l=q.parent(),p=q.data("wp-format"),n=e(".post-format-description"),o=e("#title");if(typeof a==="undefined"){a=e("#post-body-content")}l.slideUp().find("a.active").removeClass("active");q.addClass("active");e("#post_format").val(p);e(".post-format-change").show().find("span.icon").removeClass(postFormats.currentPostFormat).addClass(p);if(-1<e.inArray(p,i)){c(p);j.hide()}else{j.slideUp(200,function(){c(p);j.slideDown(400)})}o.focus();if(""===o.val()){e("#title-prompt-text").removeClass("screen-reader-text")}n.html(q.data("description"));if(n.not(":visible")){n.slideDown("fast")}if(typeof tinymce!="undefined"){m=tinymce.get("content");if(m){k=m.getBody();k.className=k.className.replace(/\bpost-format-[^ ]+/,"");m.dom.addClass(k,"post-format-"+p)}}postFormats.currentPostFormat=p}e(function(){e(".post-format-change a").click(function(){e(".post-formats-fields, .post-format-change").slideUp();e(".post-format-options").slideDown();return false});e(".post-format-options").on("click","a",function(k){k.preventDefault();h(e(this))});e(".wp-format-media-select").click(function(m){m.preventDefault();var k=e(this),o="image",n=k.closest(".wp-format-media-holder"),l=e("#wp_format_"+n.data("format"));o=n.data("format");if(b&&g===o){b.open();return}g=o;b=wp.media.frames.formatMedia=wp.media({button:{text:k.data("update")},states:[new wp.media.controller.Library({library:wp.media.query({type:o}),title:k.data("choose"),displaySettings:"image"===o})]});d=function(v){var p,r,s="",q=v.url,t=v.mime,u=v.type;if("video"===u){if(v.width){p=v.width;if(p>600){p=600}s+=' width="'+p+'"'}if(v.height){r=v.height;if(v.width&&p<v.width){r=Math.round((r*p)/v.width)}s+=' height="'+r+'"'}}e("#"+u+"-preview").remove();n.parent().prepend('<div id="'+u+'-preview" class="wp-format-media-preview"><'+u+s+' class="wp-'+u+'-shortcode" controls="controls" preload="none"><source type="'+t+'" src="'+q+'" /></'+u+"></div>");e(".wp-"+u+"-shortcode").mediaelementplayer()};b.on("select",function(){var p=0,r=0,q,s=b.state().get("selection").first().toJSON();if(0===s.mime.indexOf("audio")){l.val(s.url);d(s)}else{if(0===s.mime.indexOf("video")){s.src=s.url;l.val(wp.shortcode.string({tag:"video",attrs:_.pick(s,"src","width","height")}));d(s)}else{q=wp.media.string.image({align:getUserSetting("align"),size:getUserSetting("imgsize"),link:getUserSetting("urlbutton")},s);l.val(q);e("#image-preview").remove();if(s.width){p=s.width>600?600:s.width}if(s.height){r=s.height}if(p<s.width){r=Math.round((r*p)/s.width)}n.parent().prepend(['<div id="image-preview" class="wp-format-media-preview">','<img src="',s.url,'"',p?' width="'+p+'"':"",r?' height="'+r+'"':""," />","</div>"].join(""))}}});b.open()})})})(jQuery);