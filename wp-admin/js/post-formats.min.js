window.wp=window.wp||{};(function(b){var r,k,i,o,m,q,j=/\s?\bwp-format-[^ ]+/g,f=120,n=360,p="standard",a="short-format",d=["status"],h=["status","aside","image","audio","video"],e=["status","aside"],c=["standard","chat","status","aside","gallery"];function s(t){m.val(t);i.prop("className",i.prop("className").replace(j,"")).addClass("wp-format-"+t);o.prop("className",o.prop("className").replace(j,"")).addClass("wp-format-"+t)}function g(w,u){var t,v=b("#content, #content_ifr");t=v.outerHeight();if(f<t){n=t}if(-1<b.inArray(w,e)){if(!v.hasClass(a)){v.addClass(a);_(v).each(function(x){b(x)[u?"css":"animate"]({height:f})})}}else{v.removeClass(a).animate({height:n})}}function l(t){var z,x,u,w,B=t.data("wp-format"),A=b("#title-prompt-text"),C=b(".post-format-description"),D=b("#title"),v=b(".post-formats-fields"),y=b(".post-format-change span.icon");if(B===postFormats.currentPostFormat){return}t.addClass("active").siblings().removeClass("active");u=-1<b.inArray(B,h);w=-1<b.inArray(postFormats.currentPostFormat,h);if(w?!u:u){k.fadeToggle(200).css("display","inline-block")}u=-1<b.inArray(B,d);w=-1<b.inArray(postFormats.currentPostFormat,d);if(w?!u:u){b("#titlewrap").fadeToggle(200)}u=-1<b.inArray(B,c);w=-1<b.inArray(postFormats.currentPostFormat,c);if(u&&w){console.log("both no UI");s(B);v.hide()}else{if(w){console.log("destination only");v.hide();s(B);v.slideDown(400)}else{if(u){console.log("source only");v.slideUp(200,function(){s(B)})}else{console.log("both");v.slideUp(200,function(){s(B);v.slideDown(400)})}}}g(B);D.focus();if(""===D.val()){A.removeClass("screen-reader-text");D.keydown(function(E){A.addClass("screen-reader-text");b(E.currentTarget).unbind(E)})}C.html(t.data("description"));y.show().prop("className",y.prop("className").replace(j,"")).addClass("wp-format-"+B);if(C.not(":visible")){C.slideDown("fast")}if(tinymce){z=tinymce.get("content");if(z){x=z.getBody();x.className=x.className.replace(/\bpost-format-[^ ]+/,"");z.dom.addClass(x,"post-format-"+B)}}k.toggleClass("gallery","gallery"===B);postFormats.currentPostFormat=B}b(function(){i=b("#post-body-content");o=b(".icon32");m=b("#post_format");k=b("#insert-media-button").toggleClass("gallery","gallery"===postFormats.currentPostFormat);p=b(".post-format-options .active").data("wp-format");if(-1<b.inArray(p,e)){g(p,true)}b("#show_post_format_ui").on("change",function(){b(".wp-post-format-ui").toggleClass("no-ui",!this.checked);b.post(ajaxurl,{action:"show-post-format-ui",post_type:b("#post_type").val(),show:this.checked?1:0,nonce:b("#show_post_format_ui_nonce").val()})});b(".post-format-options").on("click","a",function(t){t.preventDefault();l(b(t.currentTarget))});b(".wp-format-media-select").click(function(y){y.preventDefault();var t=b(y.currentTarget),v,x="image",w,u;w=t.closest(".wp-format-media-holder");u=b("#wp_format_"+w.data("format"));x=w.data("format");if(r&&q===x){r.open();return}q=x;r=wp.media.frames.formatMedia=wp.media({button:{text:t.data("update")},states:[new wp.media.controller.Library({library:wp.media.query({type:x}),title:t.data("choose"),displaySettings:"image"===x})]});v=function(F){var z,B,C="",A=F.url,D=F.mime,E=F.type;if("video"===E){if(F.width){z=F.width;if(z>600){z=600}C+=' width="'+z+'"'}if(F.height){B=F.height;if(F.width&&z<F.width){B=Math.round((B*z)/F.width)}C+=' height="'+B+'"'}}b("#"+E+"-preview").remove();w.parent().prepend('<div id="'+E+'-preview" class="wp-format-media-preview"><'+E+C+' class="wp-'+E+'-shortcode" controls="controls" preload="none"><source type="'+D+'" src="'+A+'" /></'+E+"></div>");b(".wp-"+E+"-shortcode").mediaelementplayer()};r.on("select",function(){var z=0,B=0,A,C=r.state().get("selection").first().toJSON();if(0===C.mime.indexOf("audio")){u.val(C.url);v(C)}else{if(0===C.mime.indexOf("video")){C.src=C.url;u.val(wp.shortcode.string({tag:"video",attrs:_.pick(C,"src","width","height")}));v(C)}else{A=wp.media.string.image({align:getUserSetting("align"),size:getUserSetting("imgsize"),link:getUserSetting("urlbutton")},C);u.val(A);b("#image-preview").remove();if(C.width){z=C.width>600?600:C.width}if(C.height){B=C.height}if(z<C.width){B=Math.round((B*z)/C.width)}w.parent().prepend(['<div id="image-preview" class="wp-format-media-preview">','<img src="',C.url,'"',z?' width="'+z+'"':"",B?' height="'+B+'"':""," />","</div>"].join(""))}}});r.open()})})}(jQuery));