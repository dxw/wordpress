!function(a,b){var c,d,e,f,g,h,i=wp.customize;i.Setting=i.Value.extend({initialize:function(a,b,c){i.Value.prototype.initialize.call(this,b,c),this.id=a,this.transport=this.transport||"refresh",this.bind(this.preview)},preview:function(){switch(this.transport){case"refresh":return this.previewer.refresh();case"postMessage":return this.previewer.send("setting",[this.id,this()])}}}),c=function(a,c){b.each(c,function(b,c){a[c].bind(function(b,c){a.parent&&b!==c&&a.parent.trigger("change",a)})})},e=function(a){var b,c,d;b=this,a=a||{},d=function(){b.container.find(":focusable:first").focus(),b.container[0].scrollIntoView(!0)},a.completeCallback?(c=a.completeCallback,a.completeCallback=function(){d(),c()}):a.completeCallback=d,b.expand?b.expand(a):a.completeCallback()},h=function(a,b){return a.priority()===b.priority()&&"number"==typeof a.params.instanceNumber&&"number"==typeof b.params.instanceNumber?a.params.instanceNumber-b.params.instanceNumber:a.priority()-b.priority()},f=function(a){return"keydown"===a.type&&13!==a.which},g=function(a,c){var d=a.length===c.length&&-1===_.map(_.zip(a,c),function(a){return b(a[0]).is(a[1])}).indexOf(!1);return d},d=i.Class.extend({defaultActiveArguments:{duration:"fast"},defaultExpandedArguments:{duration:"fast"},initialize:function(a,d){var e=this;e.id=a,e.params={},b.extend(e,d||{}),e.container=b(e.params.content),e.deferred={ready:new b.Deferred},e.priority=new i.Value,e.active=new i.Value,e.activeArgumentsQueue=[],e.expanded=new i.Value,e.expandedArgumentsQueue=[],e.active.bind(function(a){var c=e.activeArgumentsQueue.shift();c=b.extend({},e.defaultActiveArguments,c),a=a&&e.isContextuallyActive(),e.onChangeActive(a,c)}),e.expanded.bind(function(a){var c=e.expandedArgumentsQueue.shift();c=b.extend({},e.defaultExpandedArguments,c),e.onChangeExpanded(a,c)}),e.attachEvents(),c(e,["priority","active"]),e.priority.set(isNaN(e.params.priority)?100:e.params.priority),e.active.set(e.params.active),e.expanded.set(!1)},ready:function(){},_children:function(a,b){var c=this,d=[];return i[b].each(function(b){b[a].get()===c.id&&d.push(b)}),d.sort(h),d},isContextuallyActive:function(){throw new Error("Must override with subclass.")},onChangeActive:function(a,b){var c="resolved"===i.previewer.deferred.active.state()?b.duration:0;a?this.container.stop(!0,!0).slideDown(c,b.completeCallback):this.container.stop(!0,!0).slideUp(c,b.completeCallback)},_toggleActive:function(a,b){var c=this;return b=b||{},a&&this.active.get()||!a&&!this.active.get()?(b.unchanged=!0,c.onChangeActive(c.active.get(),b),!1):(b.unchanged=!1,this.activeArgumentsQueue.push(b),this.active.set(a),!0)},activate:function(a){return this._toggleActive(!0,a)},deactivate:function(a){return this._toggleActive(!1,a)},onChangeExpanded:function(){throw new Error("Must override with subclass.")},_toggleExpanded:function(a,b){var c=this;return b=b||{},a&&this.expanded.get()||!a&&!this.expanded.get()?(b.unchanged=!0,c.onChangeExpanded(c.expanded.get(),b),!1):(b.unchanged=!1,this.expandedArgumentsQueue.push(b),this.expanded.set(a),!0)},expand:function(a){return this._toggleExpanded(!0,a)},collapse:function(a){return this._toggleExpanded(!1,a)},focus:e}),i.Section=d.extend({initialize:function(a,e){var f=this;d.prototype.initialize.call(f,a,e),f.id=a,f.panel=new i.Value,f.panel.bind(function(a){b(f.container).toggleClass("control-subsection",!!a)}),f.panel.set(f.params.panel||""),c(f,["panel"]),f.embed(),f.deferred.ready.done(function(){f.ready()})},embed:function(){var a,c=this;a=function(a){var d;a?i.panel(a,function(a){a.deferred.ready.done(function(){d=a.container.find("ul:first"),c.container.parent().is(d)||d.append(c.container),c.deferred.ready.resolve()})}):(d=b("#customize-theme-controls").children("ul"),c.container.parent().is(d)||d.append(c.container),c.deferred.ready.resolve())},c.panel.bind(a),a(c.panel.get())},attachEvents:function(){var a=this;a.container.find(".accordion-section-title").on("click keydown",function(b){f(b)||(b.preventDefault(),a.expanded()?a.collapse():a.expand())})},isContextuallyActive:function(){var a=this,b=a.controls(),c=0;return _(b).each(function(a){a.active()&&(c+=1)}),0!==c},controls:function(){return this._children("section","control")},onChangeExpanded:function(a,b){var c,d=this,e=d.container.find(".accordion-section-content");a?(c=b.unchanged?b.completeCallback:function(){e.stop().slideDown(b.duration,b.completeCallback),d.container.addClass("open")},b.allowMultiple||i.section.each(function(a){a!==d&&a.collapse({duration:b.duration})}),d.panel()?i.panel(d.panel()).expand({duration:b.duration,completeCallback:c}):c()):(d.container.removeClass("open"),e.slideUp(b.duration,b.completeCallback))}}),i.Panel=d.extend({initialize:function(a,b){var c=this;d.prototype.initialize.call(c,a,b),c.embed(),c.deferred.ready.done(function(){c.ready()})},embed:function(){var a=this,c=b("#customize-theme-controls > ul");a.container.parent().is(c)||c.append(a.container),a.deferred.ready.resolve()},attachEvents:function(){var a,b=this;b.container.find(".accordion-section-title").on("click keydown",function(a){f(a)||(a.preventDefault(),b.expanded()||b.expand())}),a=b.container.find(".panel-meta:first"),a.find("> .accordion-section-title").on("click keydown",function(c){if(!f(c)&&(c.preventDefault(),!a.hasClass("cannot-expand"))){var d=a.find(".accordion-section-content:first");a.hasClass("open")?(a.toggleClass("open"),d.slideUp(b.defaultExpandedArguments.duration)):(d.slideDown(b.defaultExpandedArguments.duration),a.toggleClass("open"))}})},sections:function(){return this._children("panel","section")},isContextuallyActive:function(){var a=this,b=a.sections(),c=0;return _(b).each(function(a){a.active()&&a.isContextuallyActive()&&(c+=1)}),0!==c},onChangeExpanded:function(a,b){if(b.unchanged)return void(b.completeCallback&&b.completeCallback());var c,d,e=this,f=e.container.closest(".accordion-section"),g=f.closest(".wp-full-overlay"),h=f.closest(".accordion-container"),j=h.find(".open"),k=g.find("#customize-theme-controls > ul > .accordion-section > .accordion-section-title").add("#customize-info > .accordion-section-title"),l=g.find(".control-panel-back"),m=f.find(".accordion-section-title").first(),n=f.find(".control-panel-content");a?(i.section.each(function(a){a.panel()||a.collapse({duration:0})}),i.panel.each(function(a){e!==a&&a.collapse({duration:0})}),n.show(0,function(){c=n.offset().top,d=h.scrollTop(),n.css("margin-top",45-c-d),f.addClass("current-panel"),g.addClass("in-sub-panel"),h.scrollTop(0),b.completeCallback&&b.completeCallback()}),k.attr("tabindex","-1"),l.attr("tabindex","0"),l.focus()):(j.removeClass("open"),f.removeClass("current-panel"),g.removeClass("in-sub-panel"),n.delay(180).hide(0,function(){n.css("margin-top","inherit"),b.completeCallback&&b.completeCallback()}),k.attr("tabindex","0"),l.attr("tabindex","-1"),m.focus(),h.scrollTop(0))}}),i.Control=i.Class.extend({defaultActiveArguments:{duration:"fast"},initialize:function(a,d){var e,f,g,h=this;h.params={},b.extend(h,d||{}),h.id=a,h.selector="#customize-control-"+a.replace(/\]/g,"").replace(/\[/g,"-"),h.templateSelector="customize-control-"+h.params.type+"-content",h.container=b(h.params.content?h.params.content:h.selector),h.deferred={ready:new b.Deferred},h.section=new i.Value,h.priority=new i.Value,h.active=new i.Value,h.activeArgumentsQueue=[],h.elements=[],e=h.container.find("[data-customize-setting-link]"),f={},e.each(function(){var a,c=b(this);if(c.is(":radio")){if(a=c.prop("name"),f[a])return;f[a]=!0,c=e.filter('[name="'+a+'"]')}i(c.data("customizeSettingLink"),function(a){var b=new i.Element(c);h.elements.push(b),b.sync(a),b.set(a())})}),h.active.bind(function(a){var c=h.activeArgumentsQueue.shift();c=b.extend({},h.defaultActiveArguments,c),h.onChangeActive(a,c)}),h.section.set(h.params.section),h.priority.set(isNaN(h.params.priority)?10:h.params.priority),h.active.set(h.params.active),c(h,["section","priority","active"]),g=b.map(h.params.settings,function(a){return a}),i.apply(i,g.concat(function(){var a;h.settings={};for(a in h.params.settings)h.settings[a]=i(h.params.settings[a]);h.setting=h.settings["default"]||null,h.embed()})),h.deferred.ready.done(function(){h.ready()})},embed:function(){var a,b=this;a=function(a){var c;a&&i.section(a,function(a){a.deferred.ready.done(function(){c=a.container.find("ul:first"),b.container.parent().is(c)||(c.append(b.container),b.renderContent()),b.deferred.ready.resolve()})})},b.section.bind(a),a(b.section.get())},ready:function(){},expand:function(a){i.section(this.section()).expand(a)},focus:e,onChangeActive:function(a,b){a?this.container.slideDown(b.duration,b.completeCallback):this.container.slideUp(b.duration,b.completeCallback)},toggle:function(a){return this.onChangeActive(a,this.defaultActiveArguments)},activate:d.prototype.activate,deactivate:d.prototype.deactivate,dropdownInit:function(){var a=this,b=this.container.find(".dropdown-status"),c=this.params,d=!1,e=function(a){"string"==typeof a&&c.statuses&&c.statuses[a]?b.html(c.statuses[a]).show():b.hide()};this.container.on("click keydown",".dropdown",function(b){f(b)||(b.preventDefault(),d||a.container.toggleClass("open"),a.container.hasClass("open")&&a.container.parent().parent().find("li.library-selected").focus(),d=!0,setTimeout(function(){d=!1},400))}),this.setting.bind(e),e(this.setting())},renderContent:function(){var a,c=this;0!==b("#tmpl-"+c.templateSelector).length&&(a=wp.template(c.templateSelector),a&&c.container&&c.container.append(a(c.params)))}}),i.ColorControl=i.Control.extend({ready:function(){var a=this,b=this.container.find(".color-picker-hex");b.val(a.setting()).wpColorPicker({change:function(){a.setting.set(b.wpColorPicker("color"))},clear:function(){a.setting.set(!1)}}),this.setting.bind(function(a){b.val(a),b.wpColorPicker("color",a)})}}),i.UploadControl=i.Control.extend({ready:function(){var a=this;this.params.removed=this.params.removed||"",this.success=b.proxy(this.success,this),this.uploader=b.extend({container:this.container,browser:this.container.find(".upload"),dropzone:this.container.find(".upload-dropzone"),success:this.success,plupload:{},params:{}},this.uploader||{}),a.params.extensions&&(a.uploader.plupload.filters=[{title:i.l10n.allowedFiles,extensions:a.params.extensions}]),a.params.context&&(a.uploader.params["post_data[context]"]=this.params.context),i.settings.theme.stylesheet&&(a.uploader.params["post_data[theme]"]=i.settings.theme.stylesheet),this.uploader=new wp.Uploader(this.uploader),this.remover=this.container.find(".remove"),this.remover.on("click keydown",function(b){f(b)||(a.setting.set(a.params.removed),b.preventDefault())}),this.removerVisibility=b.proxy(this.removerVisibility,this),this.setting.bind(this.removerVisibility),this.removerVisibility(this.setting.get())},success:function(a){this.setting.set(a.get("url"))},removerVisibility:function(a){this.remover.toggle(a!=this.params.removed)}}),i.ImageControl=i.UploadControl.extend({ready:function(){var a,c=this;this.uploader={init:function(){var a,b;this.supports.dragdrop||(a=c.container.find(".upload-fallback"),b=a.children().detach(),this.browser.detach().empty().append(b),a.append(this.browser).show())}},i.UploadControl.prototype.ready.call(this),this.thumbnail=this.container.find(".preview-thumbnail img"),this.thumbnailSrc=b.proxy(this.thumbnailSrc,this),this.setting.bind(this.thumbnailSrc),this.library=this.container.find(".library"),this.tabs={},a=this.library.find(".library-content"),this.library.children("ul").children("li").each(function(){var d=b(this),e=d.data("customizeTab"),f=a.filter('[data-customize-tab="'+e+'"]');c.tabs[e]={both:d.add(f),link:d,panel:f}}),this.library.children("ul").on("click keydown","li",function(a){if(!f(a)){var d=b(this).data("customizeTab"),e=c.tabs[d];a.preventDefault(),e.link.hasClass("library-selected")||(c.selected.both.removeClass("library-selected"),c.selected=e,c.selected.both.addClass("library-selected"))}}),this.library.on("click keydown","a",function(a){if(!f(a)){var d=b(this).data("customizeImageValue");d&&(c.setting.set(d),a.preventDefault())}}),this.tabs.uploaded&&(this.tabs.uploaded.target=this.library.find(".uploaded-target"),this.tabs.uploaded.panel.find(".thumbnail").length||this.tabs.uploaded.both.addClass("hidden")),a.each(function(){var a=c.tabs[b(this).data("customizeTab")];return a.link.hasClass("hidden")?void 0:(c.selected=a,a.both.addClass("library-selected"),!1)}),this.dropdownInit()},success:function(a){i.UploadControl.prototype.success.call(this,a),this.tabs.uploaded&&this.tabs.uploaded.target.length&&(this.tabs.uploaded.both.removeClass("hidden"),a.element=b('<a href="#" class="thumbnail"></a>').data("customizeImageValue",a.get("url")).append('<img src="'+a.get("url")+'" />').appendTo(this.tabs.uploaded.target))},thumbnailSrc:function(a){/^(https?:)?\/\//.test(a)?this.thumbnail.prop("src",a).show():this.thumbnail.hide()}}),i.HeaderControl=i.Control.extend({ready:function(){this.btnRemove=b("#customize-control-header_image .actions .remove"),this.btnNew=b("#customize-control-header_image .actions .new"),_.bindAll(this,"openMedia","removeImage"),this.btnNew.on("click",this.openMedia),this.btnRemove.on("click",this.removeImage),i.HeaderTool.currentHeader=new i.HeaderTool.ImageModel,new i.HeaderTool.CurrentView({model:i.HeaderTool.currentHeader,el:".current .container"}),new i.HeaderTool.ChoiceListView({collection:i.HeaderTool.UploadsList=new i.HeaderTool.ChoiceList,el:".choices .uploaded .list"}),new i.HeaderTool.ChoiceListView({collection:i.HeaderTool.DefaultsList=new i.HeaderTool.DefaultsList,el:".choices .default .list"}),i.HeaderTool.combinedList=i.HeaderTool.CombinedList=new i.HeaderTool.CombinedList([i.HeaderTool.UploadsList,i.HeaderTool.DefaultsList])},calculateImageSelectOptions:function(a,b){var c,d,e,f,g,h,j=parseInt(_wpCustomizeHeader.data.width,10),k=parseInt(_wpCustomizeHeader.data.height,10),l=!!parseInt(_wpCustomizeHeader.data["flex-width"],10),m=!!parseInt(_wpCustomizeHeader.data["flex-height"],10);return g=a.get("width"),f=a.get("height"),this.headerImage=new i.HeaderTool.ImageModel,this.headerImage.set({themeWidth:j,themeHeight:k,themeFlexWidth:l,themeFlexHeight:m,imageWidth:g,imageHeight:f}),b.set("canSkipCrop",!this.headerImage.shouldBeCropped()),c=j/k,d=g,e=f,d/e>c?(k=e,j=k*c):(j=d,k=j/c),h={handles:!0,keys:!0,instance:!0,persistent:!0,imageWidth:g,imageHeight:f,x1:0,y1:0,x2:j,y2:k},m===!1&&l===!1&&(h.aspectRatio=j+":"+k),m===!1&&(h.maxHeight=k),l===!1&&(h.maxWidth=j),h},openMedia:function(a){var b=_wpMediaViewsL10n;a.preventDefault(),this.frame=wp.media({button:{text:b.selectAndCrop,close:!1},states:[new wp.media.controller.Library({title:b.chooseImage,library:wp.media.query({type:"image"}),multiple:!1,priority:20,suggestedWidth:_wpCustomizeHeader.data.width,suggestedHeight:_wpCustomizeHeader.data.height}),new wp.media.controller.Cropper({imgSelectOptions:this.calculateImageSelectOptions})]}),this.frame.on("select",this.onSelect,this),this.frame.on("cropped",this.onCropped,this),this.frame.on("skippedcrop",this.onSkippedCrop,this),this.frame.open()},onSelect:function(){this.frame.setState("cropper")},onCropped:function(a){var b=a.post_content,c=a.attachment_id,d=a.width,e=a.height;this.setImageFromURL(b,c,d,e)},onSkippedCrop:function(a){var b=a.get("url"),c=a.get("width"),d=a.get("height");this.setImageFromURL(b,a.id,c,d)},setImageFromURL:function(a,b,c,d){var e,f={};f.url=a,f.thumbnail_url=a,f.timestamp=_.now(),b&&(f.attachment_id=b),c&&(f.width=c),d&&(f.height=d),e=new i.HeaderTool.ImageModel({header:f,choice:a.split("/").pop()}),i.HeaderTool.UploadsList.add(e),i.HeaderTool.currentHeader.set(e.toJSON()),e.save(),e.importImage()},removeImage:function(){i.HeaderTool.currentHeader.trigger("hide"),i.HeaderTool.CombinedList.trigger("control:removeImage")}}),i.defaultConstructor=i.Setting,i.control=new i.Values({defaultConstructor:i.Control}),i.section=new i.Values({defaultConstructor:i.Section}),i.panel=new i.Values({defaultConstructor:i.Panel}),i.PreviewFrame=i.Messenger.extend({sensitivity:2e3,initialize:function(a,c){var d=b.Deferred();d.promise(this),this.container=a.container,this.signature=a.signature,b.extend(a,{channel:i.PreviewFrame.uuid()}),i.Messenger.prototype.initialize.call(this,a,c),this.add("previewUrl",a.previewUrl),this.query=b.extend(a.query||{},{customize_messenger_channel:this.channel()}),this.run(d)},run:function(a){var c=this,d=!1,e=!1;this._ready&&this.unbind("ready",this._ready),this._ready=function(){e=!0,d&&a.resolveWith(c)},this.bind("ready",this._ready),this.bind("ready",function(a){if(a){var c={panel:a.activePanels,section:a.activeSections,control:a.activeControls};b.each(c,function(a,c){c&&b.each(c,function(b,c){var d=i[a](b);d&&d.active(c)})})}}),this.request=b.ajax(this.previewUrl(),{type:"POST",data:this.query,xhrFields:{withCredentials:!0}}),this.request.fail(function(){a.rejectWith(c,["request failure"])}),this.request.done(function(f){var g,h=c.request.getResponseHeader("Location"),i=c.signature;return h&&h!==c.previewUrl()?void a.rejectWith(c,["redirect",h]):"0"===f?void c.login(a):"-1"===f?void a.rejectWith(c,["cheatin"]):(g=f.lastIndexOf(i),-1===g||g<f.lastIndexOf("</html>")?void a.rejectWith(c,["unsigned"]):(f=f.slice(0,g)+f.slice(g+i.length),c.iframe=b("<iframe />").appendTo(c.container),c.iframe.one("load",function(){d=!0,e?a.resolveWith(c):setTimeout(function(){a.rejectWith(c,["ready timeout"])},c.sensitivity)}),c.targetWindow(c.iframe[0].contentWindow),c.targetWindow().document.open(),c.targetWindow().document.write(f),void c.targetWindow().document.close()))})},login:function(a){var c,d=this;return c=function(){a.rejectWith(d,["logged out"])},this.triedLogin?c():void b.get(i.settings.url.ajax,{action:"logged-in"}).fail(c).done(function(e){var f;"1"!==e&&c(),f=b('<iframe src="'+d.previewUrl()+'" />').hide(),f.appendTo(d.container),f.load(function(){d.triedLogin=!0,f.remove(),d.run(a)})})},destroy:function(){i.Messenger.prototype.destroy.call(this),this.request.abort(),this.iframe&&this.iframe.remove(),delete this.request,delete this.iframe,delete this.targetWindow}}),function(){var a=0;i.PreviewFrame.uuid=function(){return"preview-"+a++}}(),i.Previewer=i.Messenger.extend({refreshBuffer:250,initialize:function(a,c){var d=this,e=/^https?/;b.extend(this,c||{}),this.deferred={active:b.Deferred()},this.refresh=function(a){var b,c=a.refresh,d=function(){b=null,c.call(a)};return function(){if("number"!=typeof b){if(!a.loading)return d();a.abort()}clearTimeout(b),b=setTimeout(d,a.refreshBuffer)}}(this),this.container=i.ensure(a.container),this.allowedUrls=a.allowedUrls,this.signature=a.signature,a.url=window.location.href,i.Messenger.prototype.initialize.call(this,a),this.add("scheme",this.origin()).link(this.origin).setter(function(a){var b=a.match(e);return b?b[0]:""}),this.add("previewUrl",a.previewUrl).setter(function(a){var c;return/\/wp-admin(\/|$)/.test(a.replace(/[#?].*$/,""))?null:(b.each([a.replace(e,d.scheme()),a],function(a,e){return b.each(d.allowedUrls,function(a,b){var d;return b=b.replace(/\/+$/,""),d=e.replace(b,""),0===e.indexOf(b)&&/^([/#?]|$)/.test(d)?(c=e,!1):void 0}),c?!1:void 0}),c?c:null)}),this.previewUrl.bind(this.refresh),this.scroll=0,this.bind("scroll",function(a){this.scroll=a}),this.bind("url",this.previewUrl)},query:function(){},abort:function(){this.loading&&(this.loading.destroy(),delete this.loading)},refresh:function(){var a=this;this.abort(),this.loading=new i.PreviewFrame({url:this.url(),previewUrl:this.previewUrl(),query:this.query()||{},container:this.container,signature:this.signature}),this.loading.done(function(){this.bind("synced",function(){a.preview&&a.preview.destroy(),a.preview=this,delete a.loading,a.targetWindow(this.targetWindow()),a.channel(this.channel()),a.deferred.active.resolve(),a.send("active")}),this.send("sync",{scroll:a.scroll,settings:i.get()})}),this.loading.fail(function(b,c){"redirect"===b&&c&&a.previewUrl(c),"logged out"===b&&(a.preview&&(a.preview.destroy(),delete a.preview),a.login().done(a.refresh)),"cheatin"===b&&a.cheatin()})},login:function(){var a,c,d,e=this;return this._login?this._login:(a=b.Deferred(),this._login=a.promise(),c=new i.Messenger({channel:"login",url:i.settings.url.login}),d=b('<iframe src="'+i.settings.url.login+'" />').appendTo(this.container),c.targetWindow(d[0].contentWindow),c.bind("login",function(){d.remove(),c.destroy(),delete e._login,a.resolve()}),this._login)},cheatin:function(){b(document.body).empty().addClass("cheatin").append("<p>"+i.l10n.cheatin+"</p>")}}),i.controlConstructor={color:i.ColorControl,upload:i.UploadControl,image:i.ImageControl,header:i.HeaderControl},i.panelConstructor={},i.sectionConstructor={},b(function(){if(i.settings=window._wpCustomizeSettings,i.l10n=window._wpCustomizeControlsL10n,i.settings){if(!b.support.postMessage||!b.support.cors&&i.settings.isCrossDomain)return window.location=i.settings.url.fallback;var a,c,d=b(document.body),e=d.children(".wp-full-overlay"),j=b("#customize-info .theme-name.site-title"),k=b(".customize-controls-close"),l=b("#save");b("#customize-controls").on("keydown",function(a){var c=13===a.which,d=b(a.target);c&&(d.is("input:not([type=button])")||d.is("select"))&&a.preventDefault()}),b("#customize-info").find("> .accordion-section-title").on("click keydown",function(a){if(!f(a)){a.preventDefault();var c=b(this).parent(),d=c.find(".accordion-section-content:first");c.hasClass("cannot-expand")||(c.hasClass("open")?(c.toggleClass("open"),d.slideUp(i.Panel.prototype.defaultExpandedArguments.duration)):(d.slideDown(i.Panel.prototype.defaultExpandedArguments.duration),c.toggleClass("open")))}}),i.previewer=new i.Previewer({container:"#customize-preview",form:"#customize-controls",previewUrl:i.settings.url.preview,allowedUrls:i.settings.url.allowed,signature:"WP_CUSTOMIZER_SIGNATURE"},{nonce:i.settings.nonce,query:function(){var a={};return i.each(function(b,c){b._dirty&&(a[c]=b())}),{wp_customize:"on",theme:i.settings.theme.stylesheet,customized:JSON.stringify(a),nonce:this.nonce.preview}},save:function(){var a,c,e=this,f=b.extend(this.query(),{action:"customize_save",nonce:this.nonce.save}),g=i.state("processing");d.addClass("saving"),c=function(){var a=b.post(i.settings.url.ajax,f);i.trigger("save",a),a.always(function(){d.removeClass("saving")}),a.done(function(a){return"0"===a?(e.preview.iframe.hide(),void e.login().done(function(){e.save(),e.preview.iframe.show()})):"-1"===a?void e.cheatin():(i.each(function(a){a._dirty=!1}),void i.trigger("saved"))})},0===g()?c():(a=function(){0===g()&&(i.state.unbind("change",a),c())},i.state.bind("change",a))}}),i.previewer.bind("nonce",function(a){b.extend(this.nonce,a)}),b.each(i.settings.settings,function(a,b){i.create(a,a,b.value,{transport:b.transport,previewer:i.previewer})}),b.each(i.settings.panels,function(a,b){var c,d=i.panelConstructor[b.type]||i.Panel;c=new d(a,{params:b}),i.panel.add(a,c)}),b.each(i.settings.sections,function(a,b){var c,d=i.sectionConstructor[b.type]||i.Section;c=new d(a,{params:b}),i.section.add(a,c)}),b.each(i.settings.controls,function(a,b){var c,d=i.controlConstructor[b.type]||i.Control;c=new d(a,{params:b,previewer:i.previewer}),i.control.add(a,c)}),_.each(["panel","section","control"],function(a){var b,c=i.settings.autofocus[a];c&&i[a](c)&&(b=i[a](c),b.deferred.ready.done(function(){i.previewer.deferred.active.done(function(){b.focus()})}))}),i.reflowPaneContents=_.bind(function(){var a,c,d,e=[],f=!1;document.activeElement&&(c=b(document.activeElement)),i.panel.each(function(b){var c=b.sections(),d=_.pluck(c,"container");e.push(b),a=b.container.find("ul:first"),g(d,a.children("[id]"))||(_(c).each(function(b){a.append(b.container)}),f=!0)}),i.section.each(function(b){var c=b.controls(),d=_.pluck(c,"container");b.panel()||e.push(b),a=b.container.find("ul:first"),g(d,a.children("[id]"))||(_(c).each(function(b){a.append(b.container)}),f=!0)}),e.sort(h),d=_.pluck(e,"container"),a=b("#customize-theme-controls").children("ul"),g(d,a.children())||(_(e).each(function(b){a.append(b.container)}),f=!0),i.panel.each(function(a){var b=a.active();a.active.callbacks.fireWith(a.active,[b,b])}),i.section.each(function(a){var b=a.active();a.active.callbacks.fireWith(a.active,[b,b])}),f&&c&&c.focus()},i),i.bind("ready",i.reflowPaneContents),i.reflowPaneContents=_.debounce(i.reflowPaneContents,100),b([i.panel,i.section,i.control]).each(function(a,b){b.bind("add",i.reflowPaneContents),b.bind("change",i.reflowPaneContents),b.bind("remove",i.reflowPaneContents)}),i.previewer.previewUrl()?i.previewer.refresh():i.previewer.previewUrl(i.settings.url.home),function(){var a=new i.Values,b=a.create("saved"),c=a.create("activated"),d=a.create("processing");a.bind("change",function(){c()?b()?(l.val(i.l10n.saved).prop("disabled",!0),k.find(".screen-reader-text").text(i.l10n.close)):(l.val(i.l10n.save).prop("disabled",!1),k.find(".screen-reader-text").text(i.l10n.cancel)):(l.val(i.l10n.activate).prop("disabled",!1),k.find(".screen-reader-text").text(i.l10n.cancel))}),b(!0),c(i.settings.theme.active),d(0),i.bind("change",function(){a("saved").set(!1)}),i.bind("saved",function(){a("saved").set(!0),a("activated").set(!0)}),c.bind(function(a){a&&i.trigger("activated")}),i.state=a}(),l.click(function(a){i.previewer.save(),a.preventDefault()}).keydown(function(a){9!==a.which&&(13===a.which&&i.previewer.save(),a.preventDefault())}),b("#customize-header-actions").on("click keydown",".control-panel-back",function(a){f(a)||(a.preventDefault(),i.panel.each(function(a){a.collapse()}))}),k.keydown(function(a){9!==a.which&&(13===a.which&&this.click(),a.preventDefault())}),b(".upload-dropzone a.upload").keydown(function(a){13===a.which&&this.click()}),b(".collapse-sidebar").on("click keydown",function(a){f(a)||(e.toggleClass("collapsed").toggleClass("expanded"),a.preventDefault())}),j.length&&b("#customize-control-blogname input").on("input",function(){j.text(this.value)}),a=new i.Messenger({url:i.settings.url.parent,channel:"loader"}),a.bind("back",function(){k.on("click.customize-controls-close",function(b){b.preventDefault(),a.send("close")})}),b(window).on("beforeunload",function(){return i.state("saved")()?void 0:i.l10n.saveAlert}),b.each(["saved","change"],function(b,c){i.bind(c,function(){a.send(c)})}),i.bind("activated",function(){a.targetWindow()?a.send("activated",i.settings.url.activated):i.settings.url.activated&&(window.location=i.settings.url.activated)}),a.send("ready"),b.each({background_image:{controls:["background_repeat","background_position_x","background_attachment"],callback:function(a){return!!a}},show_on_front:{controls:["page_on_front","page_for_posts"],callback:function(a){return"page"===a}},header_textcolor:{controls:["header_textcolor"],callback:function(a){return"blank"!==a}}},function(a,c){i(a,function(a){b.each(c.controls,function(b,d){i.control(d,function(b){var d=function(a){b.container.toggle(c.callback(a))};d(a.get()),a.bind(d)})})})}),i.control("display_header_text",function(a){var b="";a.elements[0].unsync(i("header_textcolor")),a.element=new i.Element(a.container.find("input")),a.element.set("blank"!==a.setting()),a.element.bind(function(c){c||(b=i("header_textcolor").get()),a.setting.set(c?b:"blank")}),a.setting.bind(function(b){a.element.set("blank"!==b)})}),i.trigger("ready"),c=k,c.focus(),setTimeout(function(){c.focus()},200)}})}(wp,jQuery);