var ThemeViewer;(function(a){ThemeViewer=function(b){function d(){a("#filter-click, #mini-filter-click").unbind("click").click(function(){a("#filter-click").toggleClass("current");a("#filter-box").slideToggle();a("#current-theme").slideToggle(300);return false});a("#filter-box :checkbox").unbind("click").click(function(){var e=a("#filter-box :checked").length,f=a("#filter-click").text();if(f.indexOf("(")!=-1){f=f.substr(0,f.indexOf("("))}if(e==0){a("#filter-click").text(f)}else{a("#filter-click").text(f+" ("+e+")")}})}var c={init:d};return c}})(jQuery);jQuery(document).ready(function(a){theme_viewer=new ThemeViewer();theme_viewer.init()});var ThemeScroller;(function(a){ThemeScroller={nonce:"",search:"",tab:"",type:"",nextPage:2,features:{},scrollPollingDelay:500,failedRetryDelay:4000,outListBottomThreshold:300,scrolling:false,querying:false,init:function(){var b=this,c,d={},e=window.location.search;a(".pagination-links").hide();d=this.parseQuery(e.substring(1));this.nonce=a("#_ajax_fetch_list_nonce").val();this.search=d.s;this.features=d.features;this.tab=d.tab;this.type=d.type;c=parseInt(d.paged,10);if(!isNaN(c)){this.nextPage=(c+1)}this.$outList=a("#availablethemes");this.$spinner=a("div.tablenav.bottom").children("img.ajax-loading");this.$window=a(window);this.$document=a(document);if(a(".tablenav-pages").length){this.pollInterval=setInterval(function(){return b.poll()},this.scrollPollingDelay)}},poll:function(){var b=this.$document.scrollTop()+this.$window.innerHeight();if(this.querying||(b<this.$outList.height()-this.outListBottomThreshold)){return}this.ajax()},process:function(b){if((b===undefined)||(b.rows.indexOf("no-items")!=-1)){clearInterval(this.pollInterval);return}var c=parseInt(b.total_pages,10);if(this.nextPage>c){clearInterval(this.pollInterval)}if(this.nextPage<=(c+1)){this.$outList.append(b.rows)}},ajax:function(){var b=this;this.querying=true;var c={action:"fetch-list",tab:this.tab,paged:this.nextPage,s:this.search,type:this.type,_ajax_fetch_list_nonce:this.nonce,"features[]":this.features,list_args:list_args};this.$spinner.css("visibility","visible");a.getJSON(ajaxurl,c).done(function(d){b.nextPage++;b.process(d);b.$spinner.css("visibility","hidden");b.querying=false}).fail(function(){b.$spinner.css("visibility","hidden");b.querying=false;setTimeout(function(){b.ajax()},b.failedRetryDelay)})},parseQuery:function(g){var j={};if(!g){return j}var f=g.split(/[;&]/);for(var e=0;e<f.length;e++){var b=f[e].split("=");if(!b||b.length!=2){continue}var d=unescape(b[0]);var h=unescape(b[1]);h=h.replace(/\+/g," ");d=d.replace(/\[.*\]$/g,"");if(j[d]===undefined){j[d]=h}else{var c=j[d];if(!a.isArray(j[d])){j[d]=new Array(c,h)}else{j[d].push(h)}}}return j}};a(document).ready(function(b){ThemeScroller.init()})})(jQuery);